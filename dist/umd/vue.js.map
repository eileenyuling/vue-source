{"version":3,"file":"vue.js","sources":["../../src/observer/array.js","../../src/observer/index.js","../../src/state.js","../../src/init.js","../../src/index.js"],"sourcesContent":["let oldArrayProtoMethods = Array.prototype\nexport let arrayMetods = Object.create(oldArrayProtoMethods)\nlet methods = [\n  'push',\n  'pop',\n  'shift',\n  'unshift',\n  'reverse',\n  'sort',\n  'splice'\n]\nmethods.forEach(method => {\n  arrayMetods[method] = function(...args) {\n    const result = oldArrayProtoMethods[method].apply(this, args)\n    let inserted\n    const ob = this.__ob__\n    switch(key) {\n      case 'push':\n      case 'unshift':\n        inserted = args\n        break\n      case 'splice': // vue.$set原理， 后面讲\n        inserted = args.slice(2)\n        break\n      default:\n        break\n    }\n    if (inserted) {\n      ob.observeArray(inserted)\n    }\n    return result\n  }\n})","import { arrayMetods } from \"./array\"\n\nclass Observer {\n  constructor(value) {\n    // 判断一个数据是否被观测过\n    Object.defineProperty(value, '__ob__', {\n      enumerable: false, // 不能被枚举\n      configurable: false,\n      value: this\n    })\n    // value.__ob__ = this 不能这样写，因为会不断调用defineReactive， 陷入死循环\n    // 为了性能考虑，对数组的监听进行改写\n    if (Array.isArray(value)) {\n      // 函数劫持、切片编程\n      value.__proto__ = arrayMetods\n      this.observeArray(value)\n      return\n    }\n    this.walk(value)\n  }\n  walk(data) {\n    let keys = Object.keys(data)\n    keys.forEach(key => {\n      defineReactive(data, key, data[key])\n    })\n  }\n  observeArray(value) {\n    value.forEach(item => {\n      observe(item)\n    })\n  }\n}\nfunction defineReactive(data, key, value) {\n  observe(value)\n  Object.defineProperty(data, key, {\n    set(newValue) {\n      if (newValue === value) return\n      observe(newValue)\n      value = newValue\n    },\n    get() {\n      console.log('获取', value)\n      return value\n    }\n  })\n}\nexport function observe(data) {\n  if(typeof data !== 'object' || data === null) {\n    return\n  }\n  if (data.__ob__) {\n    return\n  }\n  return new Observer(data)\n}","import { observe } from \"./observer/index\"\n\nexport function initState(vm) {\n  const opts = vm.$options\n  if (opts.props) {\n    initProps(vm)\n  }\n  if (opts.methods) {\n    initMethods(vm)\n  }\n  if (opts.data) {\n    initData(vm)\n  }\n  if (opts.computed) {\n    initComputed(vm)\n  }\n  if (opts.watch) {\n    initWatch(vm)\n  }\n}\nfunction proxy(vm, data, key) {\n  Object.defineProperty(vm, key, {\n    get() {\n      return vm[data][key]\n    },\n    set(newValue) {\n      vm[data][key] = newValue\n    }\n  })\n}\nfunction initProps(){}\nfunction initMethods(){}\nfunction initData(vm){\n  let data = vm.$options.data\n  vm._data = data = typeof data === 'function' ? data.call(vm) : data\n  for (let key in data) {\n    proxy(vm, '_data', key)\n  }\n  observe(data)\n}\nfunction initComputed(){}\nfunction initWatch(){}\n","import { initState } from \"./state\"\n\nexport function initMixin(Vue){\n  Vue.prototype._init = function(options) {\n    const vm = this\n    vm.$options = options\n    initState(vm)\n  }\n}","import { initMixin } from \"./init.js\"\n\nfunction Vue(options) {\n  this._init(options)\n}\ninitMixin(Vue)\nexport default Vue"],"names":["oldArrayProtoMethods","Array","prototype","arrayMetods","Object","create","methods","forEach","method","args","result","apply","inserted","ob","__ob__","key","slice","observeArray","Observer","value","defineProperty","enumerable","configurable","isArray","__proto__","walk","data","keys","defineReactive","item","observe","set","newValue","get","console","log","initState","vm","opts","$options","props","initData","computed","watch","proxy","_data","call","initMixin","Vue","_init","options"],"mappings":"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"}